


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Traffic Router Administration &mdash; Traffic Control 3.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Traffic Router - Migrating to 3.0" href="traffic_router/migrationto2-3.html" />
    <link rel="prev" title="Traffic Monitor Administration" href="traffic_monitor.html" />
    <link href="../_static/theme_overrides.css" rel="stylesheet" type="text/css"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Traffic Control
          

          
            
            <img src="../_static/ATC-SVG-FULL-WHITE.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">CDN Basics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Traffic Control Overview</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/installation.html">Traffic Ops - Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/migration_from_10_to_20.html">Traffic Ops - Migrating from 1.x to 2.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/migration_from_20_to_22.html">Traffic Ops - Migrating from 2.0 to 2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/configuration.html">Traffic Ops - Configuring</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/using.html">Traffic Ops - Using</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/extensions.html">Managing Traffic Ops Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_portal/installation.html">Traffic Portal Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_portal/usingtrafficportal.html">Traffic Portal - Using</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_portal/default_profiles.html">Default Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_monitor.html">Traffic Monitor Administration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Traffic Router Administration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-traffic-router">Installing Traffic Router</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-traffic-router">Configuring Traffic Router</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration-files">Configuration files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dnssec">DNSSEC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#operation">Operation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rolling-zone-signing-keys">Rolling Zone Signing Keys</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting-and-log-files">Troubleshooting and Log Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#event-log-file-format">Event Log File Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#http-specifics">HTTP Specifics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dns-specifics">DNS Specifics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#geolimit-failure-redirect-feature">GeoLimit Failure Redirect Feature</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#deep-caching-deep-coverage-zone-topology">Deep Caching - Deep Coverage Zone Topology</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-it-works">How it Works</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#steering-feature">Steering Feature</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-difference-between-steering-and-client-steering">The Difference Between STEERING and CLIENT_STEERING</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#https-for-http-delivery-services">HTTPS for HTTP Delivery Services</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#protocol-options">Protocol Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#certificate-retrieval">Certificate Retrieval</a></li>
<li class="toctree-l4"><a class="reference internal" href="#certificate-chain-ordering">Certificate Chain Ordering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#suggested-way-of-setting-up-an-https-delivery-service">Suggested Way of Setting up an HTTPS Delivery Service</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#router-load-testing">Router Load Testing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-the-load-tests">Running the Load Tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tuning-recommendations">Tuning Recommendations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="traffic_router/migrationto2-3.html">Traffic Router - Migrating to 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_stats.html">Traffic Stats Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_server.html">Traffic Server Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_vault.html">Traffic Vault Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick_howto/index.html">Quick How To Guides</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Developer’s Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">APIs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Traffic Control</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Administrator’s Guide</a> &raquo;</li>
        
      <li>Traffic Router Administration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/admin/traffic_router.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="traffic-router-administration">
<h1><a class="toc-backref" href="#contents">Traffic Router Administration</a><a class="headerlink" href="#traffic-router-administration" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#traffic-router-administration" id="id12">Traffic Router Administration</a></p>
<ul>
<li><p><a class="reference internal" href="#installing-traffic-router" id="id13">Installing Traffic Router</a></p></li>
<li><p><a class="reference internal" href="#configuring-traffic-router" id="id14">Configuring Traffic Router</a></p></li>
<li><p><a class="reference internal" href="#dnssec" id="id15">DNSSEC</a></p></li>
<li><p><a class="reference internal" href="#troubleshooting-and-log-files" id="id16">Troubleshooting and Log Files</a></p></li>
<li><p><a class="reference internal" href="#geolimit-failure-redirect-feature" id="id17">GeoLimit Failure Redirect Feature</a></p></li>
<li><p><a class="reference internal" href="#deep-caching-deep-coverage-zone-topology" id="id18">Deep Caching - Deep Coverage Zone Topology</a></p></li>
<li><p><a class="reference internal" href="#steering-feature" id="id19">Steering Feature</a></p></li>
<li><p><a class="reference internal" href="#https-for-http-delivery-services" id="id20">HTTPS for HTTP Delivery Services</a></p></li>
<li><p><a class="reference internal" href="#router-load-testing" id="id21">Router Load Testing</a></p></li>
<li><p><a class="reference internal" href="#tuning-recommendations" id="id22">Tuning Recommendations</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="installing-traffic-router">
<h2><a class="toc-backref" href="#contents">Installing Traffic Router</a><a class="headerlink" href="#installing-traffic-router" title="Permalink to this headline">¶</a></h2>
<p>The following are requirements to ensure an accurate set up:</p>
<ul class="simple">
<li><p>CentOS 7</p></li>
<li><p>4 CPUs</p></li>
<li><p>8GB of RAM</p></li>
<li><p>Successful install of Traffic Ops (usually on another machine)</p></li>
<li><p>Successful install of Traffic Monitor (usually on another machine)</p></li>
<li><p>Administrative access to Traffic Ops</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hardware requirements are generally doubled if <a class="reference internal" href="#tr-dnssec"><span class="std std-ref">DNSSEC</span></a> is enabled</p>
</div>
<ol class="arabic">
<li><p>If no suitable profile exists, create a new profile for Traffic Router (‘Configure’ -&gt; ‘Profiles’ -&gt; ‘+’).</p>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Traffic Ops will <em>only</em> recognize a profile as assignable to a Traffic Router if its name starts with the prefix <code class="docutils literal notranslate"><span class="pre">ccr-</span></code>. The reason for this is a legacy limitation related to the old name for Traffic Router (Comcast Cloud Router), and will (hopefully) be rectified in the future as the old Perl parts of Traffic Ops are re-written in Go.</p>
</div>
</div></blockquote>
</li>
<li><p>Enter the Traffic Router server into Traffic Portal (or via the Traffic Ops API), assign to it a Traffic Router profile, and ensure that its status is set to <code class="docutils literal notranslate"><span class="pre">ONLINE</span></code>.</p></li>
<li><p>Ensure the Fully Qualified Domain Name (FQDN) of the Traffic Router is resolvable in DNS. This FQDN must be resolvable by the clients expected to use this CDN.</p></li>
<li><p>Install a Traffic Router server package, either from source or via <code class="docutils literal notranslate"><span class="pre">yum</span> <span class="pre">install</span> <span class="pre">traffic_router</span></code> if it happens to be in your repositories (check with <code class="docutils literal notranslate"><span class="pre">yum</span> <span class="pre">whatprovides</span> <span class="pre">traffic_router</span></code>).</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of Traffic Control version 3.0, Traffic Router depends upon a package called <code class="docutils literal notranslate"><span class="pre">tomcat</span></code>. This package should have been created when you built Traffic Router. If you get an error while installing the <code class="docutils literal notranslate"><span class="pre">traffic_router</span></code> package make sure that the <code class="docutils literal notranslate"><span class="pre">tomcat</span></code> package is available in your package repositories.</p>
</div>
</div></blockquote>
</li>
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/conf/traffic_monitor.properties</span></code> and specify the correct online Traffic Monitor(s) for your CDN. See <a class="reference internal" href="#tr-config-files"><span class="std std-ref">Configuration files</span></a></p>
<blockquote>
<div><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">traffic_monitor.properties</span></code></dt><dd><p>URL that should normally point to this file. e.x. <code class="docutils literal notranslate"><span class="pre">traffic_monitor.properties=file:/opt/traffic_router/conf/traffic_monitor.properties</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">traffic_monitor.properties.reload.period</span></code></dt><dd><p>Period to wait (in milliseconds) between reloading this file. e.x. <code class="docutils literal notranslate"><span class="pre">traffic_monitor.properties.reload.period=60000</span></code></p>
</dd>
</dl>
</div></blockquote>
</li>
<li><p>Start Traffic Router. This can be done by running <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">traffic_router</span></code> as the root user (or with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>), and test DNS lookups against that server with e.g. <code class="docutils literal notranslate"><span class="pre">dig</span></code> or <code class="docutils literal notranslate"><span class="pre">curl</span></code>. To restart Traffic Router, run <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">traffic_router</span></code> as the root user (or with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>). Also, because previously received CRConfigs will be cached, they need to be removed manually to actually be reloaded. This file should be located at <code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/db/cr-config.json</span></code>.</p></li>
<li><p>Snapshot CRConfig; See <a class="reference internal" href="traffic_ops/using.html#snapshot-crconfig"><span class="std std-ref">Snapshot CRConfig</span></a></p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Once the CRConfig is ‘snapshotted’, live traffic will be sent to the new Traffic Routers provided that their status has been set to <code class="docutils literal notranslate"><span class="pre">ONLINE</span></code>.</p>
</div>
</div></blockquote>
</li>
<li><p>Ensure that the parent domain (e.g.: <code class="docutils literal notranslate"><span class="pre">cdn.local</span></code>) for the CDN’s top level domain (e.g.: <code class="docutils literal notranslate"><span class="pre">ciab.cdn.local</span></code>) contains a delegation (Name Server records) for the new Traffic Router, and that the value specified matches the FQDN used in above.</p></li>
</ol>
</div>
<div class="section" id="configuring-traffic-router">
<h2><a class="toc-backref" href="#contents">Configuring Traffic Router</a><a class="headerlink" href="#configuring-traffic-router" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Starting with Traffic Router 1.5, many of the configuration files under <code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/conf</span></code> are only needed to override the default configuration values for Traffic Router. Most of the given default values will work well for any CDN. Critical values that must be changed are hostnames and credentials for communicating with other Traffic Control components such as Traffic Ops and Traffic Monitor.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pre-existing installations that store configuration files under <code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/conf</span></code> will still be used and honored for Traffic Router 1.5 onward.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Traffic Router 3.0 has been converted to a formal Tomcat instance, meaning that is now installed separately from the Tomcat servlet engine. The Traffic Router installation package contains all of the Traffic Router-specific software, configuration and startup scripts including some additional configuration files needed for Tomcat. These new configuration files can all be found in the <code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/conf</span></code> directory and generally serve to override Tomcat’s default settings.</p>
</div>
<p>For the most part, the configuration files and parameters that follow are used to get Traffic Router online and communicating with various Traffic Control components. Once Traffic Router is successfully communicating with Traffic Control, configuration should mostly be performed in Traffic Portal, and will be distributed throughout Traffic Control via the CRConfig snapshot process. See <a class="reference internal" href="traffic_ops/using.html#snapshot-crconfig"><span class="std std-ref">Snapshot CRConfig</span></a> for more information. Please see the parameter documentation for Traffic Router in the Using Traffic Ops guide documented under <a class="reference internal" href="traffic_ops/using.html#ccr-profile"><span class="std std-ref">Traffic Router Profile</span></a> for parameters that influence the behavior of Traffic Router via the CRConfig.</p>
<div class="section" id="configuration-files">
<span id="tr-config-files"></span><h3>Configuration files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 20%" />
<col style="width: 41%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>File name</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p>traffic_monitor.properties</p></td>
<td><p>traffic_monitor.bootstrap.hosts</p></td>
<td><p>Semicolon-delimited Traffic Monitor FQDNs - with port numbers as necessary</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-odd"><td><p>traffic_monitor.bootstrap.local</p></td>
<td><p>Use only the Traffic Monitors specified in local configuration files</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
<tr class="row-even"><td><p>traffic_monitor.properties</p></td>
<td><p>Path to the <code class="docutils literal notranslate"><span class="pre">traffic_monitor.properties</span></code> file; used internally to monitor the file
for changes</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/traffic_monitor.properties</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>traffic_monitor.properties.reload.period</p></td>
<td><p>The interval in milliseconds for Traffic Router to wait between reloading this
configuration file</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">60000</span></code></p></td>
</tr>
<tr class="row-even"><td rowspan="5"><p>dns.properties</p></td>
<td><p>dns.tcp.port</p></td>
<td><p>TCP port that Traffic Router will use for incoming DNS requests</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">53</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>dns.tcp.backlog</p></td>
<td><p>Maximum length of the queue for incoming TCP connection requests</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
<tr class="row-even"><td><p>dns.udp.port</p></td>
<td><p>UDP port that Traffic Router will use for incoming DNS requests</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">53</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>dns.max-threads</p></td>
<td><p>Maximum number of threads used to process incoming DNS requests</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1000</span></code></p></td>
</tr>
<tr class="row-even"><td><p>dns.zones.dir</p></td>
<td><p>Path to automatically generated zone files for reference</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/var/auto-zones</span></code></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>traffic_ops.properties</p></td>
<td><p>traffic_ops.username</p></td>
<td><p>Username with which to access the APIs in Traffic Ops (must be in the <code class="docutils literal notranslate"><span class="pre">admin</span></code> role)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">admin</span></code></p></td>
</tr>
<tr class="row-even"><td><p>traffic_ops.password</p></td>
<td><p>Password for the user specified in <code class="docutils literal notranslate"><span class="pre">traffic_ops.username</span></code></p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-odd"><td rowspan="10"><p>cache.properties</p></td>
<td><p>cache.geolocation.database</p></td>
<td><p>Full path to the local copy of a GeoIP2 (usually MaxMind) binary database file</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/db/GeoIP2-City.mmdb</span></code></p></td>
</tr>
<tr class="row-even"><td><p>cache.geolocation.database.refresh.period</p></td>
<td><p>The interval in milliseconds for Traffic Router to wait between polling for changes
to the GeoIP2 database</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">604800000</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>cache.czmap.database</p></td>
<td><p>Full path to the local copy of the coverage zone file</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/db/czmap.json</span></code></p></td>
</tr>
<tr class="row-even"><td><p>cache.czmap.database.refresh.period</p></td>
<td><p>The interval in milliseconds for Traffic Router to wait between polling for a new
coverage zone file</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10800000</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>cache.dczmap.database</p></td>
<td><p>Full path to the local copy of the deep coverage zone file</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/db/dczmap.json</span></code></p></td>
</tr>
<tr class="row-even"><td><p>cache.dczmap.database.refresh.period</p></td>
<td><p>The interval in milliseconds for Traffic Router to wait between polling for a new
deep coverage zone file</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10800000</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>cache.health.json</p></td>
<td><p>Full path to the local copy of the health state</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/db/health.json</span></code></p></td>
</tr>
<tr class="row-even"><td><p>cache.health.json.refresh.period</p></td>
<td><p>The interval in milliseconds which Traffic Router will poll for a new health state
file</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1000</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>cache.config.json</p></td>
<td><p>Full path to the local copy of the CRConfig</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/db/cr-config.json</span></code></p></td>
</tr>
<tr class="row-even"><td><p>cache.config.json.refresh.period</p></td>
<td><p>The interval in milliseconds which Traffic Router will poll for a new CRConfig</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">60000</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>startup.properties</p></td>
<td><p>various parameters</p></td>
<td><p>This configuration is used by <code class="docutils literal notranslate"><span class="pre">systemctl</span></code> to set environment variables when the
<code class="docutils literal notranslate"><span class="pre">traffic_router</span></code> service is started. It primarily consists of command line settings
for the Java process</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>log4j.properties</p></td>
<td><p>various parameters</p></td>
<td><p>Configuration of <code class="docutils literal notranslate"><span class="pre">log4j</span></code> is
<a class="reference external" href="http://logging.apache.org/log4j/2.x/index.html">documented on their site</a>; adjust
as needed</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-odd"><td><p>server.xml</p></td>
<td><p>various parameters</p></td>
<td><p>Traffic Router specific configuration for Apache Tomcat. See the
<a class="reference external" href="https://tomcat.apache.org/tomcat-8.5-doc/index.html">Apache Tomcat documentation</a>.</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>web.xml</p></td>
<td><p>various parameters</p></td>
<td><p>Default settings for all Web Applications running in the Traffic Router instance of
Tomcat</p></td>
<td><p>N/A</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dnssec">
<span id="tr-dnssec"></span><h2><a class="toc-backref" href="#contents">DNSSEC</a><a class="headerlink" href="#dnssec" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>Domain Name System Security Extensions (DNSSEC) is a set of extensions to DNS that provides a cryptographic mechanism for resolvers to verify the authenticity of responses served by an authoritative DNS server.</p>
<p>Several RFCs (4033, 4044, 4045) describe the low level details and define the extensions, RFC 7129 provides clarification around authenticated denial of existence of records, and finally RFC 6781 describes operational best practices for administering an authoritative DNSSEC enabled DNS server. The authenticated denial of existence RFC describes how an authoritative DNS server responds in NXDOMAIN and NODATA scenarios when DNSSEC is enabled.</p>
<p>Traffic Router currently supports DNSSEC with NSEC, however, NSEC3 and more configurable options are planned for the future.</p>
</div>
<div class="section" id="operation">
<h3>Operation<a class="headerlink" href="#operation" title="Permalink to this headline">¶</a></h3>
<p>Upon startup or a configuration change, Traffic Router obtains keys from the ‘keystore’ API in Traffic Ops which returns key signing keys (KSK) and zone signing keys (ZSK) for each Delivery Service that is a sub-domain of the CDN’s Top Level Domain (TLD) in addition to the keys for the CDN TLD itself. Each key has timing information that allows Traffic Router to determine key validity (expiration, inception, and effective dates) in addition to the appropriate Time To Live (TTL) to use for the DNSKEY record(s). All TTLs are configurable parameters; see the <a class="reference internal" href="traffic_ops/using.html#ccr-profile"><span class="std std-ref">Traffic Router Profile</span></a> documentation for more information.</p>
<p>Once Traffic Router obtains the key data from the API, it converts each public key into the appropriate record types (DNSKEY, DS) to place in zones and uses the private key to sign zones. DNSKEY records are added to each Delivery Service’s zone (e.g.: mydeliveryservice.ciab.cdn.local) for every valid key that exists, in addition to the CDN TLD’s zone. A DS record is generated from each zone’s KSK and is placed in the CDN TLD’s zone (e.g.: ciab.cdn.local); the DS record for the CDN TLD must be placed in its parent zone, which is not managed by Traffic Control.</p>
<p>The DNSKEY to DS record relationship allows resolvers to validate signatures across zone delegation points. With Traffic Control, we control all delegation points below the CDN’s TLD, <strong>however, the DS record for the CDN TLD must be placed in the parent zone (e.g.: cdn.local), which is not managed by Traffic Control</strong>. As such, the DS record must be placed in the parent zone prior to enabling DNSSEC, and prior to generating a new CDN KSK. Based on your deployment’s DNS configuration, this might be a manual process or it might be automated. Either way, extreme care and diligence must be taken and knowledge of the management of the upstream zone is imperative for a successful DNSSEC deployment.</p>
<p>To enable DNSSEC for a CDN in Traffic Portal, Go to ‘CDNs’ from the sidebar and click on the desired CDN, then toggle the ‘DNSSEC Enabled’ field to ‘true’, and click on the green ‘Update’ button to save the changes.</p>
</div>
<div class="section" id="rolling-zone-signing-keys">
<h3>Rolling Zone Signing Keys<a class="headerlink" href="#rolling-zone-signing-keys" title="Permalink to this headline">¶</a></h3>
<p>Traffic Router currently follows the zone signing key pre-publishing operational best practice described in <a class="reference external" href="https://tools.ietf.org/html/rfc6781#section-4.1.1.1">section 4.1.1.1 of RFC 6781</a>. Once DNSSEC is enabled for a CDN in Traffic Portal, key rolls are triggered by Traffic Ops via the automated key generation process, and Traffic Router selects the active zone signing keys based on the expiration information returned from the ‘keystore’ API of Traffic Ops.</p>
</div>
</div>
<div class="section" id="troubleshooting-and-log-files">
<span id="tr-logs"></span><h2><a class="toc-backref" href="#contents">Troubleshooting and Log Files</a><a class="headerlink" href="#troubleshooting-and-log-files" title="Permalink to this headline">¶</a></h2>
<p>Traffic Router log files can be found under <code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/var/log</span></code> and <code class="docutils literal notranslate"><span class="pre">/opt/tomcat/logs</span></code>. Initialization and shutdown logs are in <code class="docutils literal notranslate"><span class="pre">/opt/tomcat/logs/catalina[date].out</span></code>. Application related logging is in <code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/var/log/traffic_router.log</span></code>, while access logs are written to <code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/var/log/access.log</span></code>.</p>
<div class="section" id="event-log-file-format">
<h3>Event Log File Format<a class="headerlink" href="#event-log-file-format" title="Permalink to this headline">¶</a></h3>
<div class="section" id="summary">
<h4>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h4>
<p>All access events to Traffic Router are logged to the file <code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/var/log/access.log</span></code>
This file grows up to 200MB and gets rolled into older log files, 10 log files total are kept (total of up to 2GB of logged events per Traffic Router instance)</p>
<p>Traffic Router logs access events in a format that largely following <a class="reference external" href="https://docs.trafficserver.apache.org/en/6.0.x/admin/event-logging-formats.en.html">ATS event logging format</a></p>
</div>
<div class="section" id="message-format">
<h4>Message Format<a class="headerlink" href="#message-format" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Except for the first item, each event that is logged is a series of space-separated key/value pairs.</p></li>
<li><p>The first item is always the Unix epoch in seconds with a decimal field precision of up to milliseconds.</p></li>
<li><p>Each key/value pair is in the form of <code class="docutils literal notranslate"><span class="pre">unquoted_string=&quot;optionally</span> <span class="pre">quoted</span> <span class="pre">string&quot;</span></code></p></li>
<li><p>Values that are quoted strings may contain whitespace characters.</p></li>
<li><p>Values that are not quoted should not contains any whitespace characters.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Any value that is a single dash character or a dash character enclosed in quotes represents an empty value</p>
</div>
<table class="docutils align-default" id="id7">
<caption><span class="caption-text">Fields Always Present</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 4%" />
<col style="width: 47%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>qtype</p></td>
<td><p>Whether the request was for DNS or HTTP</p></td>
<td><p>Always “DNS” or “HTTP”</p></td>
</tr>
<tr class="row-odd"><td><p>chi</p></td>
<td><p>The IP address of the requester</p></td>
<td><p>Depends on whether this was a DNS or HTTP request, see other sections</p></td>
</tr>
<tr class="row-even"><td><p>rhi</p></td>
<td><p>The IP address of the request source address</p></td>
<td><p>Depends on whether this was a DNS or HTTP request, see other sections</p></td>
</tr>
<tr class="row-odd"><td><p>ttms</p></td>
<td><p>The amount of time in milliseconds it took Traffic Router to process the request</p></td>
<td><p>A number greater than or equal to zero</p></td>
</tr>
<tr class="row-even"><td><p>rtype</p></td>
<td><p>Routing result type</p></td>
<td><p>One of ERROR, CZ, DEEP_CZ, GEO, MISS, STATIC_ROUTE, DS_REDIRECT, DS_MISS, INIT, FED</p></td>
</tr>
<tr class="row-odd"><td><p>rloc</p></td>
<td><p>GeoLocation of result</p></td>
<td><p>Latitude and longitude in degrees as floating point numbers</p></td>
</tr>
<tr class="row-even"><td><p>rdtl</p></td>
<td><p>Result details Associated with unusual conditions</p></td>
<td><p>One of DS_NOT_FOUND, DS_NO_BYPASS, DS_BYPASS, DS_CZ_ONLY, DS_CZ_BACKUP_CG</p></td>
</tr>
<tr class="row-odd"><td><p>rerr</p></td>
<td><p>Message about an internal Traffic Router error</p></td>
<td><p>String</p></td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>If <a class="reference external" href="regionalgeo-qht">Regional Geo-Blocking</a> is enabled on the <a class="reference internal" href="../glossary.html#term-delivery-service"><span class="xref std std-term">Delivery Service</span></a>, an additional field (<code class="docutils literal notranslate"><span class="pre">rgb</span></code>) will appear.</p>
</div>
</div>
<div class="section" id="sample-message">
<h4>Sample Message<a class="headerlink" href="#sample-message" title="Permalink to this headline">¶</a></h4>
<p>Items within brackets below are detailed under the HTTP and DNS sections:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">144140678.000</span> <span class="n">qtype</span><span class="o">=</span><span class="n">DNS</span> <span class="n">chi</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">10.11</span> <span class="n">ttms</span><span class="o">=</span><span class="mi">789</span> <span class="p">[</span><span class="n">Fields</span> <span class="n">Specific</span> <span class="n">to</span> <span class="n">the</span> <span class="n">DNS</span> <span class="n">request</span><span class="p">]</span> <span class="n">rtype</span><span class="o">=</span><span class="n">CZ</span> <span class="n">rloc</span><span class="o">=</span><span class="s2">&quot;40.252611,58.439389&quot;</span> <span class="n">rdtl</span><span class="o">=-</span> <span class="n">rerr</span><span class="o">=</span><span class="s2">&quot;-&quot;</span> <span class="p">[</span><span class="n">Fields</span> <span class="n">Specific</span> <span class="n">to</span> <span class="n">the</span> <span class="n">DNS</span> <span class="n">result</span><span class="p">]</span>
<span class="mf">144140678.000</span> <span class="n">qtype</span><span class="o">=</span><span class="n">HTTP</span> <span class="n">chi</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">10.11</span> <span class="n">ttms</span><span class="o">=</span><span class="mi">789</span> <span class="p">[</span><span class="n">Fields</span> <span class="n">Specific</span> <span class="n">to</span> <span class="n">the</span> <span class="n">HTTP</span> <span class="n">request</span><span class="p">]</span> <span class="n">rtype</span><span class="o">=</span><span class="n">GEO</span> <span class="n">rloc</span><span class="o">=</span><span class="s2">&quot;40.252611,58.439389&quot;</span> <span class="n">rdtl</span><span class="o">=-</span> <span class="n">rerr</span><span class="o">=</span><span class="s2">&quot;-&quot;</span> <span class="p">[</span><span class="n">Fields</span> <span class="n">Specific</span> <span class="n">to</span> <span class="n">the</span> <span class="n">HTTP</span> <span class="n">result</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above message samples contain fields that are always present for every single access event to Traffic Router</p>
<p>144140678.000 qtype=DNS chi=192.168.10.11 rhi=- ttms=789 [Fields Specific to the DNS request] rtype=CZ rloc=”40.252611,58.439389” rdtl=- rerr=”-” [Fields Specific to the DNS result]
144140678.000 qtype=HTTP chi=192.168.10.11 rhi=- ttms=789 [Fields Specific to the HTTP request] rtype=GEO rloc=”40.252611,58.439389” rdtl=- rerr=”-” [Fields Specific to the HTTP result]</p>
</div>
</div>
<div class="section" id="fields-always-present">
<h4>Fields Always Present<a class="headerlink" href="#fields-always-present" title="Permalink to this headline">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 4%" />
<col style="width: 47%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>qtype</p></td>
<td><p>Whether the request was for DNS or HTTP</p></td>
<td><p>Always DNS or HTTP</p></td>
</tr>
<tr class="row-odd"><td><p>chi</p></td>
<td><p>The IP address of the requester</p></td>
<td><p>Depends on whether this was a DNS or HTTP request, see below sections</p></td>
</tr>
<tr class="row-even"><td><p>ttms</p></td>
<td><p>The amount of time in milliseconds it took Traffic Router to process the request</p></td>
<td><p>A number greater than or equal to zero</p></td>
</tr>
<tr class="row-odd"><td><p>rtype</p></td>
<td><p>Routing Result Type</p></td>
<td><p>One of ERROR, CZ, DEEP_CZ, GEO, MISS, STATIC_ROUTE, DS_REDIRECT, DS_MISS, INIT, FED</p></td>
</tr>
<tr class="row-even"><td><p>rloc</p></td>
<td><p>GeoLocation of result</p></td>
<td><p>Latitude and Longitude in Decimal Degrees</p></td>
</tr>
<tr class="row-odd"><td><p>rdtl</p></td>
<td><p>Result Details Associated with unusual conditions</p></td>
<td><p>One of DS_NOT_FOUND, DS_NO_BYPASS, DS_BYPASS, DS_CZ_ONLY, DS_CZ_BACKUP_CG</p></td>
</tr>
<tr class="row-even"><td><p>rerr</p></td>
<td><p>Message about internal Traffic Router Error</p></td>
<td><p>String</p></td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>If <a class="reference external" href="regionalgeo-qht">Regional Geo-Blocking</a> is enabled on the Delivery Service, an additional field (<code class="docutils literal notranslate"><span class="pre">rgb</span></code>) will appear.</p>
</div>
<div class="section" id="rtype-meanings">
<h5><code class="docutils literal notranslate"><span class="pre">rtype</span></code> Meanings<a class="headerlink" href="#rtype-meanings" title="Permalink to this headline">¶</a></h5>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-</span></code></dt><dd><p>The request was not redirected. This is usually a result of a DNS request to the Traffic Router or an explicit denial for that request</p>
</dd>
<dt>ANON_BLOCK</dt><dd><p>The client’s IP matched an <a class="reference external" href="anonymous_blocking-qht">Anonymous Blocking</a> rule and was blocked</p>
</dd>
<dt>CZ</dt><dd><p>The result was derived from Coverage Zone data based on the address in the <code class="docutils literal notranslate"><span class="pre">chi</span></code> field</p>
</dd>
<dt>DEEP_CZ</dt><dd><p>The result was derived from Deep Coverage Zone data based on the address in the <code class="docutils literal notranslate"><span class="pre">chi</span></code> field</p>
</dd>
<dt>DS_MISS</dt><dd><p>_*HTTP Only*_ No HTTP Delivery Service supports either this request’s URL path or headers</p>
</dd>
<dt>DS_REDIRECT</dt><dd><p>The result is using the Bypass Destination configured for the matched Delivery Service when that Delivery Service is unavailable or does not have the requested resource</p>
</dd>
<dt>ERROR</dt><dd><p>An internal error occurred within Traffic Router, more details may be found in the <code class="docutils literal notranslate"><span class="pre">rerr</span></code> field</p>
</dd>
<dt>FED</dt><dd><p>_*DNS Only*_ The result was obtained through federated coverage zone data outside of any Delivery Service</p>
</dd>
<dt>GEO</dt><dd><p>The result was derived from geolocation service based on the address in the <code class="docutils literal notranslate"><span class="pre">chi</span></code> field</p>
</dd>
<dt>GEO_REDIRECT</dt><dd><p>The request was redirected based on the National Geo blocking (Geo Limit Redirect URL) configured on the Delivery Service</p>
</dd>
<dt>MISS</dt><dd><p>Traffic Router was unable to resolve a DNS request or find a cache for the requested resource</p>
</dd>
<dt>RGALT</dt><dd><p>The request was redirected to the <a class="reference external" href="regionalgeo-qht">Regional Geo-Blocking</a> URL. Regional Geo blocking is enabled on the Delivery Service and is configured through the <code class="docutils literal notranslate"><span class="pre">regional_geoblock.polling.url</span></code> setting for the Traffic Router profile</p>
</dd>
<dt>RGDENY</dt><dd><p>_*DNS Only*_ The result was obtained through federated coverage zone data outside of any Delivery Service The request was regionally blocked because there was no rule for the request made</p>
</dd>
<dt>STATIC_ROUTE</dt><dd><p>_*DNS Only*_ No DNS Delivery Service supports the hostname portion of the requested url</p>
</dd>
</dl>
</div>
<div class="section" id="rdtl-meanings">
<h5><code class="docutils literal notranslate"><span class="pre">rdtl</span></code> Meanings<a class="headerlink" href="#rdtl-meanings" title="Permalink to this headline">¶</a></h5>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-</span></code></dt><dd><p>The request was not redirected. This is usually a result of a DNS request to the Traffic Router or an explicit denial for that request</p>
</dd>
<dt>DS_BYPASS</dt><dd><p>Used Bypass Destination for Redirect of Delivery Service</p>
</dd>
<dt>DS_CLIENT_GEO_UNSUPPORTED</dt><dd><p>Traffic Router did not find a resource supported by coverage zone data and was unable to determine the geographic location of the requesting client</p>
</dd>
<dt>DS_CZ_BACKUP_CG</dt><dd><p>Traffic Router found a backup cache via fall-back (CRconfig’s <code class="docutils literal notranslate"><span class="pre">edgeLocation</span></code>)  or via coordinates (CZF) configuration</p>
</dd>
<dt>DS_CZ_ONLY</dt><dd><p>The selected Delivery Service only supports resource lookup based on Coverage Zone data</p>
</dd>
<dt>DS_NO_BYPASS</dt><dd><p>No valid Bypass Destination is configured for the matched Delivery Service and the Delivery Service does not have the requested resource</p>
</dd>
<dt>DS_NOT_FOUND</dt><dd><p>Always goes with <code class="docutils literal notranslate"><span class="pre">rtypes</span></code> STATIC_ROUTE and DS_MISS</p>
</dd>
<dt>GEO_NO_CACHE_FOUND</dt><dd><p>Traffic Router could not find a resource via geographic location data based on the requesting client’s location</p>
</dd>
<dt>NO_DETAILS</dt><dd><p>This entry is for a standard request</p>
</dd>
<dt>REGIONAL_GEO_ALTERNATE_WITHOUT_CACHE</dt><dd><p>This goes with the <code class="docutils literal notranslate"><span class="pre">rtype</span></code> RGDENY. The URL is being regionally blocked</p>
</dd>
<dt>REGIONAL_GEO_NO_RULE</dt><dd><p>The request was blocked because there was no rule in the Delivery Service for the request</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="http-specifics">
<h3>HTTP Specifics<a class="headerlink" href="#http-specifics" title="Permalink to this headline">¶</a></h3>
<p>Sample Message</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1452197640.936</span> <span class="n">qtype</span><span class="o">=</span><span class="n">HTTP</span> <span class="n">chi</span><span class="o">=</span><span class="mf">69.241</span><span class="o">.</span><span class="mf">53.218</span> <span class="n">rhi</span><span class="o">=-</span> <span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://foo.mm-test.jenkins.cdnlab.comcast.net/some/asset.m3u8&quot;</span> <span class="n">cqhm</span><span class="o">=</span><span class="n">GET</span> <span class="n">cqhv</span><span class="o">=</span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="n">rtype</span><span class="o">=</span><span class="n">GEO</span> <span class="n">rloc</span><span class="o">=</span><span class="s2">&quot;40.252611,58.439389&quot;</span> <span class="n">rdtl</span><span class="o">=-</span> <span class="n">rerr</span><span class="o">=</span><span class="s2">&quot;-&quot;</span> <span class="n">pssc</span><span class="o">=</span><span class="mi">302</span> <span class="n">ttms</span><span class="o">=</span><span class="mi">0</span> <span class="n">rurl</span><span class="o">=</span><span class="s2">&quot;http://odol-atsec-sim-114.mm-test.jenkins.cdnlab.comcast.net:8090/some/asset.m3u8&quot;</span> <span class="n">rh</span><span class="o">=</span><span class="s2">&quot;Accept: */*&quot;</span> <span class="n">rh</span><span class="o">=</span><span class="s2">&quot;myheader: asdasdasdasfasg&quot;</span>
</pre></div>
</div>
<table class="docutils align-default" id="id8">
<caption><span class="caption-text">Request Fields</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 3%" />
<col style="width: 73%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>url</p></td>
<td><p>Requested URL with query string</p></td>
<td><p>A URL String</p></td>
</tr>
<tr class="row-odd"><td><p>cqhm</p></td>
<td><p>Http Method</p></td>
<td><p>e.g <code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
</tr>
<tr class="row-even"><td><p>cqhv</p></td>
<td><p>Http Protocol Version</p></td>
<td><p>e.g. <code class="docutils literal notranslate"><span class="pre">HTTP/1.1</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>rh</p></td>
<td><p>One or more of these key value pairs may exist in a logged event and are controlled by the configuration of the matched Delivery Service</p></td>
<td><p>Key/value pair of the format <code class="docutils literal notranslate"><span class="pre">name:</span> <span class="pre">value</span></code></p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id9">
<caption><span class="caption-text">Response Fields</span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 7%" />
<col style="width: 77%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>rurl</p></td>
<td><p>The resulting URL of the resource requested by the client</p></td>
<td><p>A URL String</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dns-specifics">
<h3>DNS Specifics<a class="headerlink" href="#dns-specifics" title="Permalink to this headline">¶</a></h3>
<p>Sample Message</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">144140678.000</span> <span class="n">qtype</span><span class="o">=</span><span class="n">DNS</span> <span class="n">chi</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">10.11</span> <span class="n">rhi</span><span class="o">=-</span> <span class="n">ttms</span><span class="o">=</span><span class="mi">123</span> <span class="n">xn</span><span class="o">=</span><span class="mi">65535</span> <span class="n">fqdn</span><span class="o">=</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span> <span class="nb">type</span><span class="o">=</span><span class="n">A</span> <span class="n">class</span><span class="o">=</span><span class="n">IN</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">12345</span> <span class="n">rcode</span><span class="o">=</span><span class="n">NOERROR</span> <span class="n">rtype</span><span class="o">=</span><span class="n">CZ</span> <span class="n">rloc</span><span class="o">=</span><span class="s2">&quot;40.252611,58.439389&quot;</span> <span class="n">rdtl</span><span class="o">=-</span> <span class="n">rerr</span><span class="o">=</span><span class="s2">&quot;-&quot;</span> <span class="n">ans</span><span class="o">=</span><span class="s2">&quot;192.168.1.2 192.168.3.4 0:0:0:0:0:ffff:c0a8:102 0:0:0:0:0:ffff:c0a8:304&quot;</span>
</pre></div>
</div>
<table class="docutils align-default" id="id10">
<caption><span class="caption-text">Request Fields</span><a class="headerlink" href="#id10" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 4%" />
<col style="width: 43%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xn</p></td>
<td><p>The ID from the client DNS request header</p></td>
<td><p>a whole number between 0 and 65535 (inclusive)</p></td>
</tr>
<tr class="row-odd"><td><p>rhi</p></td>
<td><p>The IP address of the resolver when ENDS0 client subnet extensions are enabled.</p></td>
<td><p>An IPv4 or IPv6 string, or dash if request is for resolver only and no client subnet is present</p></td>
</tr>
<tr class="row-even"><td><p>fqdn</p></td>
<td><p>The qname field from the client DNS request message (i.e. the
<abbr title="Fully Qualified Domain Name">FQDN</abbr> the client is requesting be</p></td>
<td><p>A series of DNS labels/domains separated by ‘.’ characters and ending with a ‘.’ character</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td><p>The qtype field from the client DNS request message (i.e. the typeof resolution
that’s requested such as IPv4, IPv6)</p></td>
<td><p>Examples are A (IpV4), AAAA (IpV6), <abbr title="Name Service">NS</abbr>,  <abbr title="Start of Authority">SOA</abbr>,
and <abbr title="Canonical Name">CNAME</abbr>, (see <a class="reference external" href="http://www.zytrax.com/books/dns/ch15/#qtype">qtype</a>)</p></td>
</tr>
<tr class="row-even"><td><p>class</p></td>
<td><p>The qclass field from the client DNS request message (i.e. the class of
resource being requested)</p></td>
<td><p>Either <abbr title="Internet resource">IN</abbr> or ANY (Traffic Router rejects requests with any other
value of class)</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id11">
<caption><span class="caption-text">Response Fields</span><a class="headerlink" href="#id11" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 5%" />
<col style="width: 54%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ttl</p></td>
<td><p>The ‘time to live’ in seconds for the answer provided by Traffic
Router (clients can reliably use this answer for this long without
re-querying traffic router)</p></td>
<td><p>A whole number between 0 and 4294967295 (inclusive)</p></td>
</tr>
<tr class="row-odd"><td><p>rcode</p></td>
<td><p>The result code for the DNS answer provided by Traffic Router</p></td>
<td><p>One of NOERROR (success), NOTIMP (request is not
NOTIMP (request is not  supported),
REFUSED (request is refused to be answered), or
NXDOMAIN (the domain/name requested does not exist)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="geolimit-failure-redirect-feature">
<span id="tr-ngb"></span><h2><a class="toc-backref" href="#contents">GeoLimit Failure Redirect Feature</a><a class="headerlink" href="#geolimit-failure-redirect-feature" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Overview<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>This feature is also called ‘National GeoBlock’ (NGB).</p>
<p>In the past, if the Geolimit check fails (for example, the client IP is not in the ‘US’ region but the Geolimit is set to ‘CZF + US’), the router will respond with <code class="docutils literal notranslate"><span class="pre">503</span> <span class="pre">Service</span> <span class="pre">Unavailable</span></code>, but with this feature, when the check fails, it will respond with <code class="docutils literal notranslate"><span class="pre">302</span> <span class="pre">Found</span></code> if the redirect URL is set in the Delivery Service.</p>
<dl class="simple">
<dt>The Geolimit check will fail in the following scenarios:</dt><dd><ul class="simple">
<li><p>When the GeoLimit is set to ‘CZF + only’ and the client IP is not in the the CZ file</p></li>
<li><p>When the GeoLimit is set to any region e.g. ‘CZF + US’ and the client IP is not in such region, and the client IP is not in the CZ file</p></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>To enable the NGB feature, the DS must be configured with the proper redirect URL. The setting for this can be found by clicking on ‘Advanced Options’ at the bottom of a Delivery Service details page, and is specified by the ‘Geo Limit Redirect URL’ field. An individual Delivery Service details page can be viewed by clicking on the desired Delivery Service under ‘Services’ -&gt; ‘Delivery Services’. If no URL is put in this field, the feature is disabled.</p>
<p>The URL has 3 kinds of formats, which have different meanings:</p>
<dl class="simple">
<dt>URL with no domain</dt><dd><p>If no domain is in the URL (e.g. ‘vod/dance.mp4’), Traffic Router will try to find a proper cache server within the Delivery Service and return the redirect URL in the format: <code class="docutils literal notranslate"><span class="pre">http://[cache</span> <span class="pre">server</span> <span class="pre">name].[Delivery</span> <span class="pre">Service's</span> <span class="pre">FQDN]/[configured</span> <span class="pre">relative</span> <span class="pre">path]</span></code></p>
</dd>
<dt>URL with domain that matches with the Delivery Service</dt><dd><p>For this URL, Traffic Router will also try to find a proper cache server within the Delivery Service and return a redirect URL in the format: <code class="docutils literal notranslate"><span class="pre">http://[cache</span> <span class="pre">server</span> <span class="pre">name].[Delivery</span> <span class="pre">Service's</span> <span class="pre">FQDN]/[configured</span> <span class="pre">relative</span> <span class="pre">path]</span></code></p>
</dd>
<dt>URL with domain that doesn’t match with the Delivery Service</dt><dd><p>Traffic Router will return the configured URL directly to the client.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="deep-caching-deep-coverage-zone-topology">
<span id="deep-cache"></span><h2><a class="toc-backref" href="#contents">Deep Caching - Deep Coverage Zone Topology</a><a class="headerlink" href="#deep-caching-deep-coverage-zone-topology" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3>Overview<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Deep Caching is a feature that enables clients to be routed to the closest possible “deep” Edge-tier caches on a per-Delivery Service basis. The term “deep” is used in the networking sense, meaning that the Edge-tier caches are located deep in the network where the number of network hops to a client is as minimal. This deep caching topology is desirable because storing content closer to the client gives better bandwidth savings, and sometimes the cost of bandwidth usage in the network outweighs the cost of adding storage. While it may not be feasible to cache an entire copy of the CDN’s contents in every deep location (for the best possible bandwidth savings), storing just a relatively small amount of the CDN’s most requested content can lead to very high bandwidth savings.</p>
</div>
<div class="section" id="getting-started">
<h3>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<p>What you need:</p>
<ol class="arabic simple">
<li><p>Edge caches deployed in “deep” locations and registered in Traffic Ops</p></li>
<li><p>A Deep Coverage Zone File (DCZF) mapping these deep cache hostnames to specific network prefixes (see <a class="reference internal" href="traffic_ops/using.html#deep-czf"><span class="std std-ref">The Deep Coverage Zone File</span></a> for details)</p></li>
<li><p>Deep caching parameters in the Traffic Router Profile (see <a class="reference internal" href="traffic_ops/using.html#ccr-profile"><span class="std std-ref">Traffic Router Profile</span></a> for details):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">deepcoveragezone.polling.interval</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deepcoveragezone.polling.url</span></code></p></li>
</ul>
</li>
<li><p>Deep Caching enabled on one or more HTTP Delivery Services (i.e. ‘Deep Caching’ field on the Delivery Service details page (under ‘Advanced Options’) set to ALWAYS)</p></li>
</ol>
</div>
<div class="section" id="how-it-works">
<h3>How it Works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h3>
<p>Deep Coverage Zone routing is very similar to that of regular Coverage Zone routing, except that the DCZF is preferred over the regular CZF for Delivery Services with Deep Caching (DC) enabled. If the client requests a DC-enabled Delivery Service and their IP address gets a “hit” in the DCZF, Traffic Router will attempt to route that client to one of the available deep caches in the client’s corresponding zone. If there are no deep caches available for a client’s request, Traffic Router will fall back to the regular CZF and continue regular CZF routing from there.</p>
</div>
</div>
<div class="section" id="steering-feature">
<span id="tr-steering"></span><h2><a class="toc-backref" href="#contents">Steering Feature</a><a class="headerlink" href="#steering-feature" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>Overview<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>A Steering Delivery Service is a Delivery Service that is used to route a client to another Delivery Service. The Type of a Steering Delivery Service is either STEERING or CLIENT_STEERING. A Steering Delivery Service will have target Delivery Services configured for it with weights assigned to them. Traffic Router uses the weights to make a consistent hash ring which it then uses to make sure that requests are routed to a target based on the configured weights. This consistent hash ring is separate from the consistent hash ring used in cache selection.</p>
<p>Special regular expressions - referred to as ‘filters’ - can also be configured for target Delivery Services to pin traffic to a specific Delivery Service. For example, if a filter called <code class="docutils literal notranslate"><span class="pre">.*/news/.*</span></code> for a target called ‘target-ds-1’ is created, any requests to Traffic Router with ‘news’ in them will be routed to ‘target-ds-1’. This will happen regardless of the configured weights.</p>
<p>Some other points of interest:</p>
<ul class="simple">
<li><p>Steering is currently only available for HTTP Delivery Services that are a part of the same CDN.</p></li>
<li><p>A new role called STEERING has been added to the Traffic Ops database. Only users with Admin or Steering privileges can modify steering assignments for a Delivery Service.</p></li>
<li><p>A new API has been created in Traffic Ops under <code class="docutils literal notranslate"><span class="pre">/internal</span></code>. A Steering user can either directly access this API to modify assignments, or use the Traffic Portal UI (‘View Targets’ under the ‘More’ drop-down menu on a Steering Delivery Service’s details page), however a filter can only be created via the API.</p></li>
<li><p>Traffic Router uses the steering API in Traffic Ops to poll for steering assignments, the assignments are then used when routing traffic.</p></li>
</ul>
<p>A couple simple use-cases for Steering are:</p>
<ul class="simple">
<li><p>Migrating traffic from one Delivery Service to another over time.</p></li>
<li><p>Trying out new functionality for a subset of traffic with an experimental Delivery Service.</p></li>
<li><p>Load balancing between Delivery Services.</p></li>
</ul>
</div>
<div class="section" id="the-difference-between-steering-and-client-steering">
<h3>The Difference Between STEERING and CLIENT_STEERING<a class="headerlink" href="#the-difference-between-steering-and-client-steering" title="Permalink to this headline">¶</a></h3>
<p>The only difference between the STEERING and CLIENT_STEERING Delivery Service Types is that CLIENT_STEERING explicitly allows a client to bypass Steering by choosing a destination Delivery Service. A client can accomplish this by providing the <code class="docutils literal notranslate"><span class="pre">X-TC-Steering-Option</span></code> HTTP header with a value of the <code class="docutils literal notranslate"><span class="pre">xml_id</span></code> of the target Delivery Service to which they desire to be routed. When Traffic Router receives this header it will route to the requested target Delivery Service regardless of weight configuration. This header is ignored by STEERING Delivery Services.</p>
</div>
<div class="section" id="id6">
<h3>Configuration<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The following needs to be completed for Steering to work correctly:</p>
<ol class="arabic simple">
<li><p>Two target Delivery Services are created in Traffic Ops. They must both be HTTP Delivery Services part of the same CDN.</p></li>
<li><p>A Delivery Service with type STEERING or CLIENT_STEERING is created in Traffic Portal.</p></li>
<li><p>Target Delivery Services are assigned to the Steering Delivery Service using Traffic Portal.</p></li>
<li><p>A user with the role of Steering is created.</p></li>
<li><p>The Steering user assigns weights to the target Delivery Services.</p></li>
<li><p>If desired, the Steering user can create filters for the target Delivery Services.</p></li>
</ol>
<p>For more information see the <a class="reference external" href="quick_howto/steering.html">Steering how-to guide</a>.</p>
</div>
</div>
<div class="section" id="https-for-http-delivery-services">
<h2><a class="toc-backref" href="#contents">HTTPS for HTTP Delivery Services</a><a class="headerlink" href="#https-for-http-delivery-services" title="Permalink to this headline">¶</a></h2>
<p>Starting with version 1.7 Traffic Router added the ability to allow HTTPS traffic between itself and clients on a per-HTTP Delivery Service basis.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of version 3.0 Traffic Router has been integrated with native OpenSSL. This makes establishing HTTPS connections to Traffic Router much less expensive than previous versions. However establishing an HTTPS connection is more computationally demanding than an HTTP connection. Since each client will in turn get redirected to ATS, Traffic Router is most always creating a new HTTPS connection for all HTTPS traffic. It is likely to mean that an existing Traffic Router may have some decrease in performance if you wish to support a lot of HTTPS traffic. As noted for DNSSEC, you may need to plan to scale Traffic Router vertically and/or horizontally to handle the new load.</p>
</div>
<p>The HTTPS set up process is:</p>
<ol class="arabic simple">
<li><p>Select one of ‘1 - HTTPS’, ‘2 - HTTP AND HTTPS’, or ‘3 - HTTP TO HTTPS’ for the Delivery Service</p></li>
<li><p>Generate private keys for the Delivery Service using a wildcard domain such as <code class="docutils literal notranslate"><span class="pre">*.my-delivery-service.my-cdn.example.com</span></code></p></li>
<li><p>Obtain and import signed certificate chain</p></li>
<li><p>Snapshot CRConfig</p></li>
</ol>
<p>Clients may make HTTPS requests to Delivery Services only after Traffic Router receives the certificate chain from Traffic Ops and the new CRConfig.</p>
<div class="section" id="protocol-options">
<h3>Protocol Options<a class="headerlink" href="#protocol-options" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>HTTP</dt><dd><p>Any secure client will get an SSL handshake error. Non-secure clients will experience the same behavior as prior to 1.7</p>
</dd>
<dt>HTTPS</dt><dd><p>Traffic Router will only redirect (send a <code class="docutils literal notranslate"><span class="pre">302</span> <span class="pre">Found</span></code> response) to clients communicating with a secure connection, all other clients will receive a <code class="docutils literal notranslate"><span class="pre">503</span> <span class="pre">Service</span> <span class="pre">Unavailable</span></code> response</p>
</dd>
<dt>HTTP AND HTTPS</dt><dd><p>Traffic Router will redirect both secure and non-secure clients</p>
</dd>
<dt>HTTP TO HTTPS</dt><dd><p>Traffic Router will redirect non-secure clients with a <code class="docutils literal notranslate"><span class="pre">302</span> <span class="pre">Found</span></code> response and a location that is secure (i.e. an <code class="docutils literal notranslate"><span class="pre">https://</span></code> URL instead of an <code class="docutils literal notranslate"><span class="pre">http://</span></code> URL), while secure clients will be redirected immediately to an appropriate target or cache server.</p>
</dd>
</dl>
</div>
<div class="section" id="certificate-retrieval">
<h3>Certificate Retrieval<a class="headerlink" href="#certificate-retrieval" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you have HTTPS Delivery Services in your CDN, Traffic Router will not accept <strong>any</strong> connections until it is able to fetch certificates from Traffic Ops and load them into memory. Traffic Router does not persist certificates to the Java Keystore or anywhere else.</p>
</div>
<p>Traffic Router fetches certificates into memory:</p>
<ul class="simple">
<li><p>At startup time</p></li>
<li><p>When it receives a new CRConfig</p></li>
<li><p>Once an hour starting whenever the most recent of the last of the above occurred</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To adjust the frequency at which Traffic Router fetches certificates add the parameter <code class="docutils literal notranslate"><span class="pre">certificates.polling.interval</span></code> to CRConfig and set it to the desired duration in milliseconds.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Taking a snapshot of CRConfig may be used at times to avoid waiting the entire polling cycle for a new set of certificates.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If a snapshot of CRConfig is made that involves a Delivery Service missing its certificates, Traffic Router will ignore <strong>ALL</strong> changes in that CRConfig until one of the following occurs:</p>
<ul class="simple">
<li><p>It receives certificates for that Delivery Service</p></li>
<li><p>Another snapshot of CRConfig is created and the Delivery Service without certificates is changed so its HTTP protocol is set to ‘http’</p></li>
</ul>
</div>
</div>
<div class="section" id="certificate-chain-ordering">
<h3>Certificate Chain Ordering<a class="headerlink" href="#certificate-chain-ordering" title="Permalink to this headline">¶</a></h3>
<p>The ordering of certificates within the certificate bundle matters. It must be:</p>
<ol class="arabic simple">
<li><p>Primary Certificate (e.g. the one created for <code class="docutils literal notranslate"><span class="pre">*.my-delivery-service.my-cdn.example.com</span></code>)</p></li>
<li><p>Intermediate Certificate(s)</p></li>
<li><p>Root Certificate from a Certificate Authority (CA) (optional)</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If something is wrong with the certificate chain (e.g. the order of the certificates is backwards or for the wrong domain) the client will get an SSL handshake. Inspection of <code class="docutils literal notranslate"><span class="pre">/opt/tomcat/logs/catalina.log</span></code> is likely to yield information to reveal this.</p>
</div>
<p>To see the ordering of certificates you may have to manually split up your certificate chain and use <code class="docutils literal notranslate"><span class="pre">openssl</span></code> on each individual certificate</p>
</div>
<div class="section" id="suggested-way-of-setting-up-an-https-delivery-service">
<h3>Suggested Way of Setting up an HTTPS Delivery Service<a class="headerlink" href="#suggested-way-of-setting-up-an-https-delivery-service" title="Permalink to this headline">¶</a></h3>
<p>Assuming you have already created a Delivery Service which you plan to modify to use HTTPS, do the following in Traffic Portal:</p>
<ol class="arabic simple">
<li><p>Select one of ‘1 - HTTPS’, ‘2 - HTTP AND HTTPS’, or ‘3 - HTTP TO HTTPS’ for the protocol field of a Delivery Service and click the ‘Update’ button</p></li>
<li><p>Under the ‘More’ drop-down menu, click ‘Manage SSL Keys’</p></li>
<li><p>Again under the ‘More’ drop-down menu, click ‘Generate SSL Keys’</p></li>
<li><p>Fill out the form and click on the green ‘Generate Keys’ button, then confirm that you want to make these changes</p></li>
<li><p>Copy the contents of the Certificate Signing Request field and save it locally</p></li>
<li><p>Go back and select ‘HTTP’ for the protocol field of the Delivery Service and click ‘Save’ (to avoid preventing other CRConfig updates from being blocked by Traffic Router)</p></li>
<li><p>Follow your standard procedure for obtaining your signed certificate chain from a CA</p></li>
<li><p>After receiving your certificate chain import it into Traffic Ops</p></li>
<li><p>Edit the Delivery Service</p></li>
<li><p>Restore your original choice for the protocol field and click save</p></li>
<li><p>Click ‘Manage SSL Keys’</p></li>
<li><p>Paste your key information into the appropriate fields</p></li>
<li><p>Click the green ‘Update Keys’ button</p></li>
<li><p>Take a new snapshot of CRConfig</p></li>
</ol>
<p>Once this is done you should be able to verify that you are being correctly redirected by Traffic Router using e.g. <code class="docutils literal notranslate"><span class="pre">curl</span></code> commands to HTTPS destinations on your Delivery Service.</p>
</div>
</div>
<div class="section" id="router-load-testing">
<h2><a class="toc-backref" href="#contents">Router Load Testing</a><a class="headerlink" href="#router-load-testing" title="Permalink to this headline">¶</a></h2>
<p>The Traffic Router load testing tool is located in the <cite>Traffic Control repository under ``test/router`</cite> &lt;<a class="reference external" href="https://github.com/apache/trafficcontrol/tree/master/test/router">https://github.com/apache/trafficcontrol/tree/master/test/router</a>&gt;`_. It can be used to simulate a mix of HTTP and HTTPS traffic for a CDN by choosing the number of HTTP Delivery Services and the number HTTPS Delivery Services the test will exercise.</p>
<p>There are 2 parts to the load test:</p>
<ul class="simple">
<li><p>A web server that makes the actual requests and takes commands to fetch data from the CDN, start the test, and return current results.</p></li>
<li><p>A web page that’s used to run the test and see the results.</p></li>
</ul>
<div class="section" id="running-the-load-tests">
<h3>Running the Load Tests<a class="headerlink" href="#running-the-load-tests" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>First, clone the <a class="reference external" href="https://github.com/apache/trafficcontrol">Traffic Control repository</a>.</p></li>
<li><p>You will need to make sure you have a CA file on your machine</p></li>
<li><p>The web server is a Go program, set your <code class="docutils literal notranslate"><span class="pre">GOPATH</span></code> environment variable appropriately (we suggest <code class="docutils literal notranslate"><span class="pre">$HOME/go</span></code> or <code class="docutils literal notranslate"><span class="pre">$HOME/src</span></code>)</p></li>
<li><p>Open a terminal emulator and navigate to the <code class="docutils literal notranslate"><span class="pre">test/router/server</span></code> directory inside of the cloned repository</p></li>
<li><p>Execute the server binary by running <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">run</span> <span class="pre">server.go</span></code></p></li>
<li><p>Using your web browser of choice, open the file <code class="docutils literal notranslate"><span class="pre">test/router/index.html</span></code></p></li>
<li><p>Authenticate against a Traffic Ops host - this should be a nearly instantaneous operation - you can watch the output from <code class="docutils literal notranslate"><span class="pre">server.go</span></code> for feedback</p></li>
<li><p>Enter the Traffic Ops host in the second form and click the button to get a list of CDN’s</p></li>
<li><p>Wait for the web page to show a list of CDN’s under the above form, this may take several seconds</p></li>
<li><p>The List of CDN’s will display the number of HTTP- and HTTPS-capable Delivery Services that may be exercised</p></li>
<li><p>Choose the CDN you want to exercise from the drop-down menu</p></li>
<li><p>Fill out the rest of the form, enter appropriate numbers for each HTTP and HTTPS delivery services</p></li>
<li><p>Click Run Test</p></li>
<li><p>As the test runs the web page will occasionally report results including running time, latency, and throughput</p></li>
</ol>
</div>
</div>
<div class="section" id="tuning-recommendations">
<h2><a class="toc-backref" href="#contents">Tuning Recommendations</a><a class="headerlink" href="#tuning-recommendations" title="Permalink to this headline">¶</a></h2>
<p>The following is an example of the command line parameters set in <code class="docutils literal notranslate"><span class="pre">/opt/traffic_router/conf/startup.properties</span></code> that has been tested on a multi-core server running under HTTPS load test requests. This is following the general recommendation to use the G1 garbage collector for JVM applications running on multi-core machines. In addition to using the G1 garbage collector the <code class="docutils literal notranslate"><span class="pre">InitiatingHeapOccupancyPercent</span></code> was lowered to run garbage collection more frequently which improved overall throughput for Traffic Router and reduced ‘Stop the World’ garbage collection. Note that any environment variable settings in this file will override those
set in <code class="docutils literal notranslate"><span class="pre">/lib/systemd/system/traffic_router.service</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CATALINA_OPTS</span><span class="o">=</span><span class="s2">&quot;\</span>
<span class="s2">-server -Xms2g -Xmx8g \</span>
<span class="s2">-Dlog4j.configuration=file://</span><span class="nv">$CATALINA_BASE</span><span class="s2">/conf/log4j.properties \</span>
<span class="s2">-Djava.library.path=/usr/lib64 \</span>
<span class="s2">-XX:+UseG1GC \</span>
<span class="s2">-XX:+UnlockExperimentalVMOptions \</span>
<span class="s2">-XX:InitiatingHeapOccupancyPercent=30&quot;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="traffic_router/migrationto2-3.html" class="btn btn-neutral float-right" title="Traffic Router - Migrating to 3.0" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="traffic_monitor.html" class="btn btn-neutral float-left" title="Traffic Monitor Administration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Traffic Control

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>