


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Traffic Server Administration &mdash; Traffic Control 3.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Traffic Vault Administration" href="traffic_vault.html" />
    <link rel="prev" title="Traffic Stats Administration" href="traffic_stats.html" />
    <link href="../_static/theme_overrides.css" rel="stylesheet" type="text/css"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Traffic Control
          

          
            
            <img src="../_static/ATC-SVG-FULL-WHITE.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">CDN Basics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Traffic Control Overview</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/installation.html">Traffic Ops - Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/migration_from_10_to_20.html">Traffic Ops - Migrating from 1.x to 2.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/migration_from_20_to_22.html">Traffic Ops - Migrating from 2.0 to 2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/configuration.html">Traffic Ops - Configuring</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/using.html">Traffic Ops - Using</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_ops/extensions.html">Managing Traffic Ops Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_portal/installation.html">Traffic Portal Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_portal/usingtrafficportal.html">Traffic Portal - Using</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_portal/default_profiles.html">Default Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_monitor.html">Traffic Monitor Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_router.html">Traffic Router Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_router/migrationto2-3.html">Traffic Router - Migrating to 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_stats.html">Traffic Stats Administration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Traffic Server Administration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-traffic-server">Installing Traffic Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-traffic-server">Configuring Traffic Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installing-the-ort-script">Installing the ORT script</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="traffic_vault.html">Traffic Vault Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick_howto/index.html">Quick How To Guides</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Developer’s Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">APIs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Traffic Control</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Administrator’s Guide</a> &raquo;</li>
        
      <li>Traffic Server Administration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/admin/traffic_server.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="traffic-server-administration">
<h1>Traffic Server Administration<a class="headerlink" href="#traffic-server-administration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installing-traffic-server">
<h2>Installing Traffic Server<a class="headerlink" href="#installing-traffic-server" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Build the Traffic Server RPM. The best way to do this is to follow the <a class="reference external" href="https://docs.trafficserver.apache.org/en/latest/getting-started/index.en.html#installation">Apache Traffic Server documentation</a>.</p></li>
<li><p>Build the astats RPM using the appropriate version number Sample link: <a class="reference external" href="https://github.com/apache/trafficcontrol/tree/master/traffic_server">https://github.com/apache/trafficcontrol/tree/master/traffic_server</a></p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">astats</span></code> plugin is bundled as a part of Apache Traffic Server as of version 7.2.</p>
</div>
<ol class="arabic">
<li><p>Install Traffic Server and astats</p>
<blockquote>
<div><p>The easiest way to accomplish this is by running this command as the root user (or with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>yum -y install trafficserver-*.rpm astats_over_http*.rpm
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Add the server using the Traffic Portal UI:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Under ‘Configure’, select ‘Servers’.</p></li>
<li><p>Click on the ‘+’ button at the top of the page.</p></li>
<li><dl class="simple">
<dt>Complete the form. Be sure to fill out all fields marked ‘Required’</dt><dd><ul class="simple">
<li><p>Set ‘Interface Name’ to the name of the network interface device from which Apache Traffic Server delivers content.</p></li>
<li><p>Set ‘Type’ to ‘MID’ or ‘EDGE’.</p></li>
<li><p>If you wish for the server to immediately be polled by the <a class="reference internal" href="../overview/traffic_monitor.html#health-proto"><span class="std std-ref">Health Protocol</span></a>, set ‘Status’ to ‘REPORTED’.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Click on the ‘Create’ button to submit the form.</p></li>
<li><p>Verify that the server status is now listed as <strong>Reported</strong></p></li>
</ol>
</div></blockquote>
</li>
<li><p>Install the ORT script and run it in ‘BADASS’ mode to create the initial configuration, see <a class="reference internal" href="#traffic-ops-ort"><span class="std std-ref">Configuring Traffic Server</span></a></p></li>
<li><p>Start the service by running <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">trafficserver</span></code> as the root user (or with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>)</p></li>
<li><p>Configure traffic server to start automatically: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">trafficserver</span></code></p></li>
<li><p>Verify that the installation is good:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Make sure that the service is running: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">trafficserver</span></code></p></li>
<li><p>Assuming a traffic monitor is already installed, browse to it, i.e. <a class="reference external" href="http:/">http:/</a>/&lt;trafficmonitorURL&gt;, and verify that the traffic server appears in the “Cache States” table, in white.</p></li>
</ol>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="configuring-traffic-server">
<span id="traffic-ops-ort"></span><h2>Configuring Traffic Server<a class="headerlink" href="#configuring-traffic-server" title="Permalink to this headline">¶</a></h2>
<p>All of the Traffic Server application configuration files are generated by Traffic Ops and installed by way of the traffic_ops_ort.pl script.
The <code class="docutils literal notranslate"><span class="pre">traffic_ops_ort.pl</span></code> file should be installed on all caches (See <a class="reference internal" href="#installing-ort"><span class="std std-ref">Installing the ORT script</span></a>), usually in <code class="docutils literal notranslate"><span class="pre">/opt/ort</span></code>. It is used to do the initial install of the configuration files when the cache is being deployed, and to keep the confiurationg files up to date when the cache is already in service. The usage message of the script is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo /opt/ort/traffic_ops_ort.pl
====-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-====
Usage: ./traffic_ops_ort.pl &lt;Mode&gt; &lt;Log_Level&gt; &lt;Traffic_Ops_URL&gt; &lt;Traffic_Ops_Login&gt; [optional flags]
        &lt;Mode&gt; = interactive - asks questions during config process.
        &lt;Mode&gt; = report - prints config differences and exits.
        &lt;Mode&gt; = badass - attempts to fix all config differences that it can.
        &lt;Mode&gt; = syncds - syncs delivery services with what is configured in Traffic Ops.
        &lt;Mode&gt; = revalidate - checks for updated revalidations in Traffic Ops and applies them. Requires Traffic Ops 2.1.

        &lt;Log_Level&gt; =&gt; ALL, TRACE, DEBUG, INFO, WARN, ERROR, FATAL, NONE

        &lt;Traffic_Ops_URL&gt; = URL to Traffic Ops host. Example: https://trafficops.company.net

        &lt;Traffic_Ops_Login&gt; =&gt; Example: &#39;username:password&#39;

        [optional flags]:
                dispersion=&lt;time&gt;      =&gt; wait a random number between 0 and &lt;time&gt; before starting. Default = 300.
                login_dispersion=&lt;time&gt;  =&gt; wait a random number between 0 and &lt;time&gt; before login. Default = 0.
                retries=&lt;number&gt;       =&gt; retry connection to Traffic Ops URL &lt;number&gt; times. Default = 3.
                wait_for_parents=&lt;0|1&gt; =&gt; do not update if parent_pending = 1 in the update json. Default = 1, wait for parents.
====-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-====
$
</pre></div>
</div>
<div class="section" id="installing-the-ort-script">
<span id="installing-ort"></span><h3>Installing the ORT script<a class="headerlink" href="#installing-the-ort-script" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Build the ORT script RPM from the <a class="reference external" href="https://builds.apache.org/view/S-Z/view/TrafficControl/">Apache Build Server</a> and install it. Assuming you’ve named the file you downloaded <code class="docutils literal notranslate"><span class="pre">traffic_ops_ort.rpm</span></code>, this can be installed simply by running this command as the root user (or with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>):</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>yum install -y traffic_ops_ort.rpm
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Install modules required by ORT if needed: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">yum</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">perl-JSON</span> <span class="pre">perl-Crypt-SSLeay</span></code></p></li>
<li><p>For initial configuration or when major changes (like a Profile change) need to be made, run the script in “badass mode”. All required rpm packages will be installed, all Traffic Server configuration files will be fetched and installed, and (if needed) the Traffic Server application will be restarted.</p>
<blockquote>
<div><p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo /opt/ort/traffic_ops_ort.pl --dispersion=0 BADASS WARN https://ops.$tcDomain admin:admin123
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>First run gives a lot of state errors that are expected. The BADASS mode fixes these issue s. Run it a second time, this should be cleaner. Also, note that many ERROR messages emitted by ORT are actually information messages. Do not panic.</p>
</div>
</div></blockquote>
</li>
<li><p>Create a cron entry for running ORT in ‘SYNCDS’ mode every 15 minutes. This makes Traffic Control check periodically if ‘Queue Updates’ was run on Traffic Portal or on Traffic Ops, and if so get the updated configuration.</p>
<blockquote>
<div><p>This can be done by running <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code> as the root user (or with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>) and adding the following line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*/</span><span class="mi">15</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">ort</span><span class="o">/</span><span class="n">traffic_ops_ort</span><span class="o">.</span><span class="n">pl</span> <span class="n">SYNCDS</span> <span class="n">WARN</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">traffops</span><span class="o">.</span><span class="n">kabletown</span><span class="o">.</span><span class="n">net</span> <span class="n">admin</span><span class="p">:</span><span class="n">password</span> <span class="o">--</span><span class="n">login_dispersion</span><span class="o">=</span><span class="mi">30</span> <span class="o">--</span><span class="n">dispersion</span><span class="o">=</span><span class="mi">180</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ort</span><span class="o">/</span><span class="n">syncds</span><span class="o">.</span><span class="n">log</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</div>
<p>Changing <code class="docutils literal notranslate"><span class="pre">https://traffops.kabletown.net</span></code>, <code class="docutils literal notranslate"><span class="pre">admin</span></code>, and <code class="docutils literal notranslate"><span class="pre">password</span></code> to your CDN URL and credentials.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, running ORT on an Edge-tier cache server will cause it to first wait for its parents (usually Mid-tier cache servers) to download their configuration before downloading its own configuration. Because of this, scheduling ORT for running every 15 minutes (with 5 minutes default dispersion) means that it might take up to ~35 minutes for a “Queue Updates” operation to affect all cache servers. To customize this dispersion time, use the command line option <code class="docutils literal notranslate"><span class="pre">--dispersion=x</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> is the number of seconds for the dispersion period. Servers will select a random number from within this dispersion period to being downloading configuration files from Traffic Ops. Another option, <code class="docutils literal notranslate"><span class="pre">--login_dispersion=x</span></code> can be used to create a dispersion period after the job begins during which ORT will wait before logging in and checking Traffic Ops for updates to the server. This defaults to 0. If <code class="docutils literal notranslate"><span class="pre">use_reval_pending</span></code>, a.k.a. Rapid Revalidate is enabled, Edge-tier cache servers will NOT wait for their parents to download their configuration before downloading their own.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In SYNCDS mode, the ORT script updates only configurations that might be changed as part of normal operations, such as:</p>
<ul class="simple">
<li><p>Delivery Services</p></li>
<li><p>SSL certificates</p></li>
<li><p>Traffic Monitor IP addresses</p></li>
<li><p>Logging configuration</p></li>
<li><p>Revalidation requests (By default. If Rapid Revalidate is enabled, this will only be checked by using a separate revalidate command in ORT.)</p></li>
</ul>
</div>
</div></blockquote>
</li>
<li><p>If Rapid Revalidate is enabled in Traffic Ops, create a second cron job for revalidation checks. ORT will not check revalidation files if Rapid Revalidate is enabled. This setting allows for a separate check to be performed every 60 seconds to verify if a revalidation update has been made. This can be done by running <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code> as the root user (or with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>) and adding the following line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*/</span><span class="mi">1</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">ort</span><span class="o">/</span><span class="n">traffic_ops_ort</span><span class="o">.</span><span class="n">pl</span> <span class="n">REVALIDATE</span> <span class="n">WARN</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">traffops</span><span class="o">.</span><span class="n">kabletown</span><span class="o">.</span><span class="n">net</span> <span class="n">admin</span><span class="p">:</span><span class="n">password</span> <span class="o">--</span><span class="n">login_dispersion</span><span class="o">=</span><span class="mi">30</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ort</span><span class="o">/</span><span class="n">syncds</span><span class="o">.</span><span class="n">log</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="traffic_vault.html" class="btn btn-neutral float-right" title="Traffic Vault Administration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="traffic_stats.html" class="btn btn-neutral float-left" title="Traffic Stats Administration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Traffic Control

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>